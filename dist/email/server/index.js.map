{"version":3,"file":"index.js","sources":["../../../src/email/server/html-to-text.ts","../../../src/email/server/tailwind-mapping-context.tsx","../../../src/email/server/render-email.tsx","../../../src/email/server/tailwind-to-inline.ts"],"sourcesContent":["/**\n * HTML to Plain Text Converter for Email\n *\n * Converts HTML email content to well-formatted plain text while preserving\n * structure, links, and readability. Optimized for email clients that prefer\n * or require plain text alternatives.\n */\n\n/**\n * Convert HTML string to plain text with preserved structure\n *\n * This converter:\n * - Preserves heading hierarchy with visual markers (# for h1, ## for h2, etc.)\n * - Converts links to [text](url) format\n * - Formats buttons as [BUTTON TEXT]: url\n * - Maintains paragraph breaks and whitespace\n * - Removes all HTML tags and styling\n * - Wraps lines at 78 characters (email standard)\n *\n * @param html - HTML string to convert\n * @returns Plain text string\n */\nexport function htmlToPlainText(html: string): string {\n  if (!html) {\n    return '';\n  }\n\n  let text = html;\n\n  // Remove script and style tags entirely\n  text = text.replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '');\n  text = text.replace(/<style\\b[^<]*(?:(?!<\\/style>)<[^<]*)*<\\/style>/gi, '');\n\n  // Remove HTML comments\n  text = text.replace(/<!--[\\s\\S]*?-->/g, '');\n\n  // Convert headings with visual hierarchy\n  text = text.replace(/<h1[^>]*>(.*?)<\\/h1>/gi, '\\n\\n# $1\\n\\n');\n  text = text.replace(/<h2[^>]*>(.*?)<\\/h2>/gi, '\\n\\n## $1\\n\\n');\n  text = text.replace(/<h3[^>]*>(.*?)<\\/h3>/gi, '\\n\\n### $1\\n\\n');\n  text = text.replace(/<h4[^>]*>(.*?)<\\/h4>/gi, '\\n\\n#### $1\\n\\n');\n  text = text.replace(/<h5[^>]*>(.*?)<\\/h5>/gi, '\\n\\n##### $1\\n\\n');\n  text = text.replace(/<h6[^>]*>(.*?)<\\/h6>/gi, '\\n\\n###### $1\\n\\n');\n\n  // Convert links to markdown-style: [text](url)\n  text = text.replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, (_match, url, linkText) => {\n    // Clean link text from any nested HTML\n    const cleanText = linkText.replace(/<[^>]+>/g, '').trim();\n\n    // If link text is same as URL, just show URL\n    if (cleanText === url || !cleanText) {\n      return url;\n    }\n\n    return `${cleanText} (${url})`;\n  });\n\n  // Convert buttons to emphasized format with URL\n  text = text.replace(/<button[^>]*>(.*?)<\\/button>/gi, '\\n\\n[BUTTON: $1]\\n\\n');\n\n  // Convert horizontal rules to text dividers\n  text = text.replace(/<hr[^>]*>/gi, '\\n\\n────────────────────────────────────────\\n\\n');\n\n  // Convert line breaks to newlines\n  text = text.replace(/<br\\s*\\/?>/gi, '\\n');\n\n  // Convert paragraphs to double newlines\n  text = text.replace(/<\\/p>/gi, '\\n\\n');\n  text = text.replace(/<p[^>]*>/gi, '');\n\n  // Convert divs to line breaks\n  text = text.replace(/<\\/div>/gi, '\\n');\n  text = text.replace(/<div[^>]*>/gi, '');\n\n  // Convert list items\n  text = text.replace(/<li[^>]*>(.*?)<\\/li>/gi, '• $1\\n');\n  text = text.replace(/<\\/(ul|ol)>/gi, '\\n');\n  text = text.replace(/<(ul|ol)[^>]*>/gi, '');\n\n  // Convert table cells to tabs\n  text = text.replace(/<\\/td>/gi, '\\t');\n  text = text.replace(/<td[^>]*>/gi, '');\n  text = text.replace(/<\\/tr>/gi, '\\n');\n  text = text.replace(/<tr[^>]*>/gi, '');\n  text = text.replace(/<\\/(table|thead|tbody|tfoot)>/gi, '\\n');\n  text = text.replace(/<(table|thead|tbody|tfoot)[^>]*>/gi, '');\n\n  // Convert strong/bold to *text*\n  text = text.replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '*$2*');\n\n  // Convert emphasis/italic to _text_\n  text = text.replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '_$2_');\n\n  // Convert code blocks\n  text = text.replace(/<pre[^>]*>(.*?)<\\/pre>/gis, (_match, code) => {\n    const cleanCode = code.replace(/<[^>]+>/g, '');\n    return `\\n\\n\\`\\`\\`\\n${cleanCode}\\n\\`\\`\\`\\n\\n`;\n  });\n\n  // Convert inline code\n  text = text.replace(/<code[^>]*>(.*?)<\\/code>/gi, '`$1`');\n\n  // Remove all remaining HTML tags\n  text = text.replace(/<[^>]+>/g, '');\n\n  // Decode HTML entities\n  text = decodeHTMLEntities(text);\n\n  // Clean up whitespace\n  text = text.replace(/\\t/g, '    '); // Convert tabs to spaces\n  text = text.replace(/\\r\\n/g, '\\n'); // Normalize line endings\n  text = text.replace(/\\r/g, '\\n');\n  text = text.replace(/ +/g, ' '); // Multiple spaces to single space\n  text = text.replace(/\\n\\n\\n+/g, '\\n\\n'); // Max 2 consecutive newlines\n  text = text.trim();\n\n  // Wrap lines at 78 characters (email standard)\n  text = wrapText(text, 78);\n\n  return text;\n}\n\n/**\n * Decode common HTML entities to their character equivalents\n *\n * @param text - Text with HTML entities\n * @returns Decoded text\n */\nfunction decodeHTMLEntities(text: string): string {\n  const entities: Record<string, string> = {\n    '&amp;': '&',\n    '&lt;': '<',\n    '&gt;': '>',\n    '&quot;': '\"',\n    '&#39;': \"'\",\n    '&apos;': \"'\",\n    '&nbsp;': ' ',\n    '&mdash;': '—',\n    '&ndash;': '–',\n    '&hellip;': '...',\n    '&copy;': '©',\n    '&reg;': '®',\n    '&trade;': '™',\n    '&bull;': '•',\n    '&middot;': '·',\n    '&laquo;': '«',\n    '&raquo;': '»',\n    '&ldquo;': '\"',\n    '&rdquo;': '\"',\n    '&lsquo;': \"'\",\n    '&rsquo;': \"'\",\n  };\n\n  let decoded = text;\n\n  // Replace named entities\n  for (const [entity, char] of Object.entries(entities)) {\n    decoded = decoded.replace(new RegExp(entity, 'g'), char);\n  }\n\n  // Replace numeric entities (e.g., &#8220; or &#x2022;)\n  decoded = decoded.replace(/&#(\\d+);/g, (_match, dec) => {\n    return String.fromCharCode(Number(dec));\n  });\n\n  decoded = decoded.replace(/&#x([0-9a-f]+);/gi, (_match, hex) => {\n    return String.fromCharCode(Number.parseInt(hex, 16));\n  });\n\n  return decoded;\n}\n\n/**\n * Wrap text at specified line length while preserving formatting\n *\n * @param text - Text to wrap\n * @param maxLength - Maximum line length (default: 78)\n * @returns Wrapped text\n */\nfunction wrapText(text: string, maxLength = 78): string {\n  const lines = text.split('\\n');\n  const wrappedLines: string[] = [];\n\n  for (const line of lines) {\n    // Don't wrap empty lines or lines that are part of code blocks\n    if (!line.trim() || line.startsWith('```') || line.startsWith('    ')) {\n      wrappedLines.push(line);\n      continue;\n    }\n\n    // Don't wrap headings\n    if (line.startsWith('#')) {\n      wrappedLines.push(line);\n      continue;\n    }\n\n    // Don't wrap list items\n    if (line.trim().startsWith('•')) {\n      wrappedLines.push(line);\n      continue;\n    }\n\n    // Wrap long lines at word boundaries\n    if (line.length <= maxLength) {\n      wrappedLines.push(line);\n    } else {\n      const words = line.split(' ');\n      let currentLine = '';\n\n      for (const word of words) {\n        if (currentLine.length + word.length + 1 <= maxLength) {\n          currentLine += (currentLine ? ' ' : '') + word;\n        } else {\n          if (currentLine) {\n            wrappedLines.push(currentLine);\n          }\n          currentLine = word;\n        }\n      }\n\n      if (currentLine) {\n        wrappedLines.push(currentLine);\n      }\n    }\n  }\n\n  return wrappedLines.join('\\n');\n}\n\n/**\n * Preview text extractor - gets first N characters suitable for email preview\n *\n * @param html - HTML content\n * @param maxLength - Maximum preview length (default: 100)\n * @returns Preview text\n */\nexport function extractPreviewText(html: string, maxLength = 100): string {\n  const plainText = htmlToPlainText(html);\n\n  // Remove heading markers for preview\n  const cleaned = plainText.replace(/^#+\\s*/gm, '').trim();\n\n  // Get first paragraph or sentence\n  const lines = cleaned.split('\\n\\n');\n  const firstContent = lines.find(line => line.trim().length > 0) || '';\n\n  // Truncate to maxLength\n  if (firstContent.length <= maxLength) {\n    return firstContent;\n  }\n\n  // Truncate at word boundary\n  const truncated = firstContent.slice(0, maxLength);\n  const lastSpace = truncated.lastIndexOf(' ');\n\n  if (lastSpace > maxLength * 0.8) {\n    return `${truncated.slice(0, lastSpace)}...`;\n  }\n\n  return `${truncated}...`;\n}\n","/**\n * Tailwind Styles Map Context\n *\n * Provides Tailwind CSS styles map to email components during server-side rendering.\n * Follows dependency injection pattern - styles map is provided at render time.\n */\n\nimport { createContext, useContext } from 'react';\nimport type { TailwindToCSSMap, DynamicUtilityPattern } from './@types/tailwind-to-inline.types';\n\nexport interface TailwindStylesMap {\n  cssMap: TailwindToCSSMap;\n  dynamicPatterns: DynamicUtilityPattern[];\n}\n\nconst TailwindStylesMapContext = createContext<TailwindStylesMap | null>(null);\n\n/**\n * Get current Tailwind styles map from context\n * Returns empty styles map if not provided (graceful degradation)\n */\nexport function useTailwindStylesMap(): TailwindStylesMap {\n  const stylesMap = useContext(TailwindStylesMapContext);\n\n  // Graceful fallback if no context provided\n  if (!stylesMap) {\n    return {\n      cssMap: {},\n      dynamicPatterns: [],\n    };\n  }\n\n  return stylesMap;\n}\n\n/**\n * Provider for injecting Tailwind styles map into email component tree\n */\nexport function TailwindStylesMapProvider({ stylesMap, children }: { stylesMap: TailwindStylesMap; children: React.ReactNode }): React.JSX.Element {\n  return <TailwindStylesMapContext.Provider value={stylesMap}>{children}</TailwindStylesMapContext.Provider>;\n}\n","/**\n * Email Rendering System using React Router SSR\n *\n * This module provides email rendering using React's server-side rendering\n * capabilities, integrated with Tailwind CSS inline style conversion and\n * plain text generation for maximum email client compatibility.\n */\n\nimport type { JSXElementConstructor, ReactElement } from 'react';\nimport { renderToStaticMarkup } from 'react-dom/server';\nimport type { EmailRenderOptions, RenderedEmail } from '../components/@types/email-components.types';\nimport { htmlToPlainText } from './html-to-text';\nimport { TailwindStylesMapProvider } from './tailwind-mapping-context';\n\n/**\n * Props wrapper that includes subject metadata\n * The subject is not passed to the component, but used for email metadata\n */\nexport type EmailTemplatePropsWithSubject<TComponentProps> = TComponentProps & {\n  subject: string | ((props: TComponentProps) => string);\n};\n\n/**\n * Render React email component to HTML and plain text\n *\n * This function uses React Router's server-side rendering to convert\n * React components to HTML, then processes the output for email compatibility:\n * - Converts Tailwind classes to inline styles (handled by components)\n * - Generates plain text version from HTML\n * - Optimizes for email client compatibility\n *\n * @param component - React component function\n * @param props - Component props including subject\n * @param options - Rendering options\n * @returns Rendered email with HTML and text versions\n *\n * @example\n * ```typescript\n * const email = await renderEmail(WelcomeEmail, {\n *   name: 'John Doe',\n *   subject: 'Welcome to our platform!'\n * });\n * // Returns: { html: '...', text: '...', subject: 'Welcome...' }\n * ```\n */\nexport async function renderEmail<TComponentProps>(\n  component: (props: TComponentProps) => ReactElement<unknown, string | JSXElementConstructor<unknown>>,\n  props: EmailTemplatePropsWithSubject<TComponentProps>,\n  options?: EmailRenderOptions\n): Promise<RenderedEmail> {\n  const { subject, ...componentProps } = props;\n\n  // Determine email subject\n  let emailSubject: string;\n  let actualProps: TComponentProps;\n\n  if (typeof subject === 'function') {\n    // Subject is a function - derive from component props\n    actualProps = componentProps as TComponentProps;\n    emailSubject = subject(actualProps);\n  } else {\n    // Subject is a string\n    actualProps = props as TComponentProps;\n    emailSubject = subject;\n  }\n\n  // Render component to static HTML using React Router SSR\n  // renderToStaticMarkup is used because we don't need React hydration in emails\n  const componentElement = component(actualProps);\n\n  // Wrap with TailwindStylesMapProvider if styles map provided (dependency injection)\n  const wrappedElement = options?.tailwindStylesMap ? <TailwindStylesMapProvider stylesMap={options.tailwindStylesMap}>{componentElement}</TailwindStylesMapProvider> : componentElement;\n\n  const htmlOutput = renderToStaticMarkup(wrappedElement);\n\n  // Post-process HTML for email compatibility\n  let html = htmlOutput;\n\n  // Add DOCTYPE and ensure proper structure\n  if (!html.includes('<!DOCTYPE')) {\n    html = `<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\\n${html}`;\n  }\n\n  // Add XML namespace if not present\n  if (html.includes('<html') && !html.includes('xmlns=')) {\n    html = html.replace('<html', '<html xmlns=\"http://www.w3.org/1999/xhtml\"');\n  }\n\n  // Pretty print in development mode\n  if (options?.pretty) {\n    html = prettyPrintHTML(html);\n  }\n\n  // Generate plain text version\n  const text = htmlToPlainText(html);\n\n  return {\n    html,\n    text,\n    subject: emailSubject,\n  };\n}\n\n/**\n * Pretty print HTML for development/debugging\n * Adds indentation and line breaks for readability\n *\n * @param html - HTML string\n * @returns Formatted HTML\n */\nfunction prettyPrintHTML(html: string): string {\n  // Simple pretty printing - can be enhanced with a proper HTML formatter\n  let formatted = html;\n\n  // Add newlines after closing tags\n  formatted = formatted.replace(/(<\\/[^>]+>)(?!<\\/)/g, '$1\\n');\n\n  // Add newlines before opening tags (except inline elements)\n  formatted = formatted.replace(/(<(?!\\/)[^>]+>)(?!<)/g, '\\n$1');\n\n  // Clean up extra newlines\n  formatted = formatted.replace(/\\n\\n+/g, '\\n\\n');\n\n  // Add indentation (basic implementation)\n  const lines = formatted.split('\\n');\n  let indent = 0;\n  const indented: string[] = [];\n\n  for (const line of lines) {\n    const trimmed = line.trim();\n    if (!trimmed) continue;\n\n    // Decrease indent for closing tags\n    if (trimmed.startsWith('</')) {\n      indent = Math.max(0, indent - 1);\n    }\n\n    // Add indented line\n    indented.push('  '.repeat(indent) + trimmed);\n\n    // Increase indent for opening tags (not self-closing)\n    if (trimmed.startsWith('<') && !trimmed.startsWith('</') && !trimmed.endsWith('/>') && !trimmed.includes('<!DOCTYPE')) {\n      // Check if it's not an inline/self-closing element\n      const tagName = trimmed.match(/<(\\w+)/)?.[1];\n      if (tagName && !['img', 'br', 'hr', 'input', 'meta', 'link'].includes(tagName)) {\n        indent++;\n      }\n    }\n  }\n\n  return indented.join('\\n');\n}\n\n/**\n * Batch render multiple email templates\n * Useful for generating email previews or testing\n *\n * @param templates - Array of template configurations\n * @returns Array of rendered emails\n */\nexport async function renderEmailBatch<T>(\n  templates: Array<{\n    component: (props: T) => ReactElement;\n    props: EmailTemplatePropsWithSubject<T>;\n    options?: EmailRenderOptions;\n  }>\n): Promise<RenderedEmail[]> {\n  return Promise.all(templates.map(template => renderEmail(template.component, template.props, template.options)));\n}\n\n/**\n * Render email component to HTML only (no text version)\n * Useful for preview or when plain text is not needed\n *\n * @param component - React component\n * @param props - Component props\n * @returns HTML string\n */\nexport function renderEmailHTML<TComponentProps>(component: (props: TComponentProps) => ReactElement, props: TComponentProps): string {\n  return renderToStaticMarkup(component(props));\n}\n\n/**\n * Legacy compatibility wrapper for existing renderEmailTemplate\n * This maintains backward compatibility with the current email system\n *\n * @deprecated Use renderEmail instead\n */\nexport async function renderEmailTemplate<TComponentProps>(\n  component: (props: TComponentProps) => ReactElement<unknown, string | JSXElementConstructor<unknown>>,\n  props: EmailTemplatePropsWithSubject<TComponentProps>\n): Promise<{ subject: string; html: string; text: string }> {\n  const result = await renderEmail(component, props);\n  return {\n    subject: result.subject || '',\n    html: result.html,\n    text: result.text,\n  };\n}\n","/**\n * Tailwind CSS to Inline Styles Converter\n *\n * Converts Tailwind utility classes to inline styles for email client compatibility.\n * Styles Maps provided via parameter (dependency injection pattern).\n */\n\nimport { logger } from '@ycore/forge/logger';\nimport type { TailwindStylesMap } from './tailwind-mapping-context';\n\n/**\n * Convert Tailwind className string to inline CSSProperties\n * Styles Maps are explicitly dependency injected\n */\nexport function tailwindToInline(className: string | undefined, existingStyle: React.CSSProperties | undefined, stylesMap: TailwindStylesMap): React.CSSProperties {\n  if (!className) {\n    return existingStyle || {};\n  }\n\n  const classes = className.split(/\\s+/).filter(Boolean);\n  const inlineStyles: React.CSSProperties = { ...existingStyle };\n\n  for (const cls of classes) {\n    const staticStyle = stylesMap.cssMap[cls];\n    if (staticStyle) {\n      Object.assign(inlineStyles, staticStyle);\n      continue;\n    }\n\n    let matched = false;\n    for (const pattern of stylesMap.dynamicPatterns) {\n      const matches = cls.match(pattern.regex);\n      if (matches) {\n        const dynamicStyle = pattern.converter(matches);\n        if (dynamicStyle) {\n          Object.assign(inlineStyles, dynamicStyle);\n          matched = true;\n          break;\n        }\n      }\n    }\n\n    if (!matched) {\n      logger.warning('tailwind_class_not_found', {\n        className: cls,\n        hint: \"Run 'bun run email:generate' to update styles maps\",\n      });\n    }\n  }\n\n  return inlineStyles;\n}\n\n/**\n * Convert CSSProperties to inline style string\n */\nexport function cssPropertiesToString(styles: React.CSSProperties): string {\n  return Object.entries(styles)\n    .map(([key, value]) => {\n      const cssKey = key.replace(/([A-Z])/g, '-$1').toLowerCase();\n      return `${cssKey}:${value}`;\n    })\n    .join(';');\n}\n\n/**\n * Merge multiple className strings into inline styles\n */\nexport function mergeClassNamesToInline(classNames: (string | undefined)[], existingStyle: React.CSSProperties | undefined, stylesMap: TailwindStylesMap): React.CSSProperties {\n  let merged = { ...existingStyle };\n\n  for (const className of classNames) {\n    if (className) {\n      merged = tailwindToInline(className, merged, stylesMap);\n    }\n  }\n\n  return merged;\n}\n\n/**\n * Extract background color from Tailwind className for legacy bgcolor attribute\n */\nexport function extractBgColor(className: string | undefined, style: React.CSSProperties | undefined, stylesMap: TailwindStylesMap): string | undefined {\n  if (style?.backgroundColor) {\n    return normalizeColor(style.backgroundColor);\n  }\n\n  if (!className) {\n    return undefined;\n  }\n\n  const classes = className.split(/\\s+/).filter(Boolean);\n\n  for (const cls of classes) {\n    if (cls.startsWith('bg-')) {\n      const cssProperties = stylesMap.cssMap[cls];\n      if (cssProperties?.backgroundColor) {\n        return normalizeColor(cssProperties.backgroundColor);\n      }\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Normalize color value to hex format\n */\nfunction normalizeColor(color: string | React.CSSProperties['backgroundColor']): string {\n  if (typeof color !== 'string') {\n    return '#ffffff';\n  }\n\n  if (color.startsWith('#')) {\n    return color;\n  }\n\n  const namedColors: Record<string, string> = {\n    white: '#ffffff',\n    black: '#000000',\n    transparent: '#ffffff',\n  };\n\n  const normalized = color.toLowerCase();\n  if (namedColors[normalized]) {\n    return namedColors[normalized];\n  }\n\n  return color;\n}\n"],"names":[],"mappings":"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"}